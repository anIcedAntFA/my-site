---
import type { HTMLAttributes } from 'astro/types';
import { transform } from 'ultrahtml';
import sanitize from 'ultrahtml/transformers/sanitize';

import { isAbsoluteURL } from '@lib/text';

interface Props extends HTMLAttributes<'a'> {}

const { href, ...anchorAttrs } = Astro.props;

const isAbsolute = typeof href === 'string' && isAbsoluteURL(href);

const labelHTML = await Astro.slots.render('default');
const labelString = await transform(labelHTML, [
	sanitize({ unblockElements: [] }),
]);
---

<a
	aria-label={`Read more about ${labelString}`}
	href={href}
	target={isAbsolute ? '_blank' : undefined}
	rel={isAbsolute ? 'noopener noreferrer' : undefined}
	data-text-link
	{...anchorAttrs}><slot /></a
>
